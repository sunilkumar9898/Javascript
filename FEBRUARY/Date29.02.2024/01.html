<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Post And Get Data By Api</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        /* CSS styles remain unchanged from your provided code */
    </style>
</head>
<body>
    <div class="container">
        <div class="table">
            <table border="1">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Mobile</th>
                        <th>City</th>
                        <th>State</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
        <!-- Removed form section since it's not relevant for editing rows -->
    </div>

    <script>
        let editMode = false;

        async function getrowValue(data) {
            // Toggle edit mode
            editMode = !editMode;
            // Get the row elements
            let tr = event.target.parentNode.parentNode;
            let tds = tr.querySelectorAll("td");
            // If in edit mode, make the row editable
            if (editMode) {
                for (let i = 1; i < tds.length - 1; i++) {
                    let input = document.createElement("input");
                    input.value = tds[i].innerText;
                    tds[i].innerText = "";
                    tds[i].appendChild(input);
                }
                event.target.innerText = "Save";
            } else { // If not in edit mode, save the changes
                let newData = {
                    name: tds[1].querySelector("input").value,
                    email: tds[2].querySelector("input").value,
                    mobile: tds[3].querySelector("input").value,
                    city: tds[4].querySelector("input").value,
                    state: tds[5].querySelector("input").value
                };
                // Call updateData function passing newData and data.id
                updateData(data.id, newData);
                event.target.innerText = "Edit";
            }
        }

        const updateData = async (id, newData) => {
            try {
                // Send PATCH request to update data
                const response = await axios.patch(`http://localhost:8080/data/${id}`, newData);
                console.log("Updated data with id:", id, "New data:", newData);
                console.log("Response:", response.data); // Log the response data
                // If the update was successful, you can handle it accordingly
            } catch (error) {
                console.log(error);
                // Handle errors, such as network issues or server errors
            }
        };

        // Function to display data in the table
        const displayData = (data1) => {
            let tbody = document.getElementById("tbody");
            data1.map((item) => {
                let tr = document.createElement("tr");
                let id1 = document.createElement("td");
                id1.innerText = item.id;
                let name = document.createElement("td");
                name.innerText = item.name;
                let email = document.createElement("td");
                email.innerText = item.email;
                let mobile = document.createElement("td");
                mobile.innerText = item.mobile;
                let city = document.createElement("td");
                city.innerText = item.city;
                let state = document.createElement("td");
                state.innerText = item.state;
                let btnE = document.createElement("td");
                let btn2 = document.createElement("button");
                btn2.innerText = "Edit";
                btn2.style.backgroundColor = "green";
                btn2.addEventListener("click", () => {
                    getrowValue(item);
                });
                btnE.append(btn2);
                tr.append(id1, name, email, mobile, city, state, btnE);
                tbody.append(tr);
            });
        };

        // Load data from the server
        async function loadData() {
            try {
                let response = await axios.get("http://localhost:8080/data");
                let data = response.data;
                displayData(data);
            } catch (error) {
                console.log(error);
            }
        }

        // Call loadData function to load data when the page loads
        loadData();
    </script>
</body>
</html>
